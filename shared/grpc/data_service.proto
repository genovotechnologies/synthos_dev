syntax = "proto3";

service DataService {
  // Get signed upload URL
  rpc GetUploadURL(UploadRequest) returns (UploadResponse);
  // Mark upload complete
  rpc CompleteUpload(CompleteRequest) returns (CompleteResponse);
  // Get dataset metadata
  rpc GetDatasetMetadata(MetadataRequest) returns (MetadataResponse);
  // Stream dataset chunks
  rpc StreamDataset(StreamRequest) returns (stream DataChunk);
}

message UploadRequest {
  string user_id = 1;
  string filename = 2;
  int64 file_size = 3;
  string file_type = 4;
}

message UploadResponse {
  string dataset_id = 1;
  string upload_url = 2;
  string upload_method = 3;
  int32 chunk_size = 4;
  int32 expires_in = 5;
}

message StreamRequest {
  string dataset_id = 1;
  int64 start_row = 2;
  int64 end_row = 3;
  int32 chunk_size = 4;
}

message DataChunk {
  string dataset_id = 1;
  int64 chunk_number = 2;
  int64 start_row = 3;
  int64 end_row = 4;
  bytes data = 5; // Compressed data (Parquet or CSV)
  string format = 6;
}

message CompleteRequest {}

message CompleteResponse {}

message MetadataRequest {}

message MetadataResponse {}
