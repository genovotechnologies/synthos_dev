version: 1.0
runtime: python3
build:
  commands:
    build:
      - echo "Installing dependencies..."
      - pip install --upgrade pip
      - pip install -r requirements.txt
      - echo "Build completed successfully!"
  env:
    - name: PYTHONPATH
      value: /root
    - name: PIP_CACHE_DIR
      value: /tmp/pip-cache
run:
  command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 2
  network:
    port: 8000
    env: PORT
  env:
    # Core Configuration
    - name: ENVIRONMENT
      value: "production"
    - name: DEBUG
      value: "true"
    - name: PORT
      value: "8000"
    - name: HOST
      value: "0.0.0.0"
    - name: PYTHONPATH
      value: /root

    # API Configuration
    - name: API_V1_STR
      value: "/api/v1"

    # File Storage
    - name: UPLOAD_PATH
      value: "/app/uploads"
    - name: EXPORT_PATH
      value: "/app/exports"

    # CORS Configuration
    - name: CORS_ORIGINS
      value: "https://synthos.dev,https://synthos-dev.vercel.app,http://localhost:3000"
    - name: ALLOWED_HOSTS
      value: "*"

    # Cache Configuration
    - name: CACHE_BACKEND
      value: "redis"
    - name: AWS_ELASTICACHE_PORT
      value: "6379"
    - name: AWS_ELASTICACHE_USE_TLS
      value: "true"

    # RDS Configuration
    - name: AWS_RDS_PORT
      value: "5432"
    - name: AWS_RDS_DATABASE
      value: "synthos"
    - name: AWS_RDS_USE_SSL
      value: "true"

    # Payment Configuration
    - name: PADDLE_ENVIRONMENT
      value: "production"
    - name: PRIMARY_PAYMENT_PROVIDER
      value: "paddle"
    - name: ENABLE_MULTIPLE_PAYMENT_PROVIDERS
      value: "true"

    # AWS S3
    - name: AWS_S3_BUCKET
      value: "synthos-dev"

    # Limits
    - name: FREE_TIER_MONTHLY_LIMIT
      value: "10000"
    - name: MAX_SYNTHETIC_ROWS
      value: "5000000"

    # Pricing Tiers (JSON string)
    - name: PRICING_TIERS
      value: '{"starter": {"price": 99, "stripe_price_id": "price_starter_monthly", "paddle_product_id": "pro_01jzp36tyrsdg91hprxx47zhwb"}, "professional": {"price": 599, "stripe_price_id": "price_professional_monthly", "paddle_product_id": "pro_01jzp3ds3cj4y0x9y53ftcmmkk"}, "growth": {"price": 1299, "stripe_price_id": "price_growth_monthly", "paddle_product_id": "pro_01jzp3gcsceh34w3jvyyn68rhr"}}'

    # RDS Proxy
    - name: USE_RDS_PROXY
      value: "true"
    - name: USE_IAM_AUTH
      value: "false"